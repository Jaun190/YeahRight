<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login mit Handy | Hashcore</title>

<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #1b0033, #0a001a);
    color: white;
    padding: 2rem;
    max-width: 400px;
    margin: auto;
  }
  input, button {
    font-size: 1rem;
    padding: 0.75rem;
    margin: 0.5rem 0;
    width: 100%;
    border-radius: 5px;
    border: none;
  }
  button {
    background-color: #7b2cbf;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background-color: #894edd;
  }
  #errorMsg {
    color: #ff5555;
    margin-top: 0.5rem;
  }
</style>

<script src="https://www.gstatic.com/firebasejs/10.6.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.2/firebase-auth.js"></script>
</head>

<body>

<h1>Login mit Handynummer</h1>

<!-- ReCaptcha Container, wird unsichtbar -->
<div id="recaptcha-container"></div>

<!-- Eingabe Handynummer -->
<input type="text" id="phoneNumber" placeholder="+49 170 1234567" />

<!-- Button SMS-Code anfordern -->
<button id="sendCodeBtn">SMS-Code senden</button>

<!-- Eingabe SMS-Code, erst sichtbar nach Codeanforderung -->
<input type="text" id="verificationCode" placeholder="SMS-Code eingeben" style="display:none;" />

<!-- Button Code verifizieren -->
<button id="verifyCodeBtn" style="display:none;">Einloggen</button>

<p id="errorMsg"></p>

<script>
  // Firebase konfigurieren (deine config einfÃ¼gen)
  const firebaseConfig = {
    apiKey: "API_KEY_HERE",
    authDomain: "hashcore-f4d96.firebaseapp.com",
    projectId: "hashcore-f4d96",
    storageBucket: "hashcore-f4d96.appspot.com",
    messagingSenderId: "386291046348",
    appId: "1:386291046348:web:e3aa80fd0ef77900786f69"
  };

  // Firebase initialisieren
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // ReCaptcha unsichtbar einrichten
  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
    size: 'invisible',
    callback: () => {
      console.log('ReCaptcha erfolgreich');
    }
  });

  const sendCodeBtn = document.getElementById('sendCodeBtn');
  const verifyCodeBtn = document.getElementById('verifyCodeBtn');
  const phoneNumberInput = document.getElementById('phoneNumber');
  const verificationCodeInput = document.getElementById('verificationCode');
  const errorMsg = document.getElementById('errorMsg');

  let confirmationResult;

  sendCodeBtn.onclick = () => {
    errorMsg.textContent = '';
    const phoneNumber = phoneNumberInput.value;
    if (!phoneNumber) {
      errorMsg.textContent = 'Bitte gib eine Handynummer ein.';
      return;
    }

    // SMS-Code anfordern
    auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
      .then((result) => {
        confirmationResult = result;
        errorMsg.textContent = 'SMS-Code gesendet! Bitte Code eingeben.';
        verificationCodeInput.style.display = 'block';
        verifyCodeBtn.style.display = 'block';
        sendCodeBtn.style.display = 'none';
      })
      .catch((error) => {
        errorMsg.textContent = 'Fehler beim Senden: ' + error.message;
        window.recaptchaVerifier.render().then(widgetId => {
          grecaptcha.reset(widgetId);
        });
      });
  };

  verifyCodeBtn.onclick = () => {
    const code = verificationCodeInput.value;
    if (!code) {
      errorMsg.textContent = 'Bitte gib den SMS-Code ein.';
      return;
    }

    // Code verifizieren
    confirmationResult.confirm(code)
      .then((result) => {
        const user = result.user;
        errorMsg.textContent = 'Login erfolgreich! Weiterleitung...';
        // Nach 1 Sekunde weiterleiten
        setTimeout(() => {
          window.location.href = 'dashboard.html';
        }, 1000);
      })
      .catch((error) => {
        errorMsg.textContent = 'Falscher Code: ' + error.message;
      });
  };
</script>

</body>
</html>
