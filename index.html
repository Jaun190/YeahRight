<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Mining Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; text-align: center; }
    .card { background: #222; padding: 20px; margin: 20px auto; border-radius: 12px; width: 400px; }
    button { background: #28a745; color: white; padding: 10px; border: none; border-radius: 6px; cursor: pointer; }
    button:disabled { background: gray; }
    h1 { color: #0f0; }
  </style>
</head>
<body>
  <h1>Hashline Mining Dashboard</h1>
  <div class="card">
    <p><b>Wallet:</b> <span id="wallet">Nicht verbunden</span></p>
    <button onclick="connectWallet()">Wallet verbinden</button>
  </div>

  <div class="card">
    <h2>Mining Abo kaufen</h2>
    <p>Wähle dein Mining-Paket:</p>
    <button onclick="buyPlan(1)">Basic – 0.01 ETH / Monat</button>
    <button onclick="buyPlan(2)">Pro – 0.05 ETH / Monat</button>
    <button onclick="buyPlan(3)">Elite – 0.1 ETH / Monat</button>
  </div>

  <div class="card">
    <h2>Deine Mining Rate</h2>
    <p><span id="rate">0</span> Hash/s</p>
  </div>

  <div class="card">
    <h2>Admin Bereich</h2>
    <button onclick="withdraw()">Pool Auszahlung</button>
  </div>

<script>
  let web3;
  let contract;
  const contractAddress = "DEINE_CONTRACT_ADRESSE"; // nach Deployment eintragen
  const abi = [
    {
      "inputs":[{"internalType":"uint8","name":"plan","type":"uint8"}],
      "name":"buyPlan","outputs":[],"stateMutability":"payable","type":"function"
    },
    {
      "inputs":[],"name":"getRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
      "stateMutability":"view","type":"function"
    },
    {
      "inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"
    }
  ];

  async function connectWallet() {
    if (window.ethereum) {
      web3 = new Web3(window.ethereum);
      await ethereum.request({ method: "eth_requestAccounts" });
      const accounts = await web3.eth.getAccounts();
      document.getElementById("wallet").innerText = accounts[0];
      contract = new web3.eth.Contract(abi, contractAddress);
      loadRate();
    } else {
      alert("Bitte MetaMask installieren!");
    }
  }

  async function buyPlan(plan) {
    const accounts = await web3.eth.getAccounts();
    let value = "0";
    if (plan === 1) value = web3.utils.toWei("0.01", "ether");
    if (plan === 2) value = web3.utils.toWei("0.05", "ether");
    if (plan === 3) value = web3.utils.toWei("0.1", "ether");
    await contract.methods.buyPlan(plan).send({ from: accounts[0], value });
    loadRate();
  }

  async function loadRate() {
    const accounts = await web3.eth.getAccounts();
    const rate = await contract.methods.getRate().call({ from: accounts[0] });
    document.getElementById("rate").innerText = rate;
  }

  async function withdraw() {
    const accounts = await web3.eth.getAccounts();
    await contract.methods.withdraw().send({ from: accounts[0] });
    alert("Auszahlung ausgeführt");
  }
</script>
</body>
</html>
